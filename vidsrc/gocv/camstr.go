package vidsrc

import "log"

// The cam string is a map of strings that can be used by OpenCV to
// open up and start recording from a camera.

var camstrmap map[string]string

// Make some hard coded decisions for now. We will test
func init() {
	camstrmap = map[string]string{
		"jetson":  jetsonCamstr(),
		"nano":    jetsonCamstr(),
		"rpi":     "0",
		"mac":     "0",
		"linux":   "/dev/video0",
		"default": "0",
		"0":       "0",
	}
}

func jetsonCamstr() string {
	gstpipe := "nvarguscamerasrc ! " +
		"video/x-raw(memory:NVMM), width=(int)1280, height=(int)720, format=(string)NV12, framerate=(fraction)60/1 ! " +
		"nvvidconv flip-method=0 ! " +
		"video/x-raw, width=(int)1280, height=(int)720, format=(string)BGRx ! " +
		"videoconvert ! " +
		"video/x-raw, format=(string)BGR !" +
		"appsink	"
	return gstpipe
}

// GetCamstr returns a string that OpenCV understands depending on the
// platform we are running on.
func GetCamstr(name string) (camstr string) {
	var ex bool
	if camstr, ex = camstrmap[name]; !ex {
		log.Println("name: ", name, " camstr Index NOT found, use raw string")
		camstr = name
	}
	return camstr
}
